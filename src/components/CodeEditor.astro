---
let { code, language, config } = Astro.props;

import editorWorker from 'monaco-editor/esm/vs/editor/editor.worker?worker';
import jsonWorker from 'monaco-editor/esm/vs/language/json/json.worker?worker';
import cssWorker from 'monaco-editor/esm/vs/language/css/css.worker?worker';
import htmlWorker from 'monaco-editor/esm/vs/language/html/html.worker?worker';
import tsWorker from 'monaco-editor/esm/vs/language/typescript/ts.worker?worker';

if (typeof window !== 'undefined') {
  self.MonacoEnvironment = {
    getWorker: function (_moduleId: any, label: string) {
      if (label === "json") {
        return new jsonWorker();
      }
      if (label === "css" || label === "scss" || label === "less") {
        return new cssWorker();
      }
      if (label === "html" || label === "handlebars" || label === "razor") {
        return new htmlWorker();
      }
      if (label === "javascript" || label === "typescript") {
        return new tsWorker();
      }
      return new editorWorker();
    }
  };

  // Merge code and language into config
  Object.assign(config, { value: code.trim() || "", language: language || "plaintext" });
}
---

<div id="code-container" style="width: 100%; height: 500px;" data-config={config}></div>

<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/loader.js"></script>

<script>
 /* let div = document.getElementById("code-container");
* 
* import('monaco-editor').then((monaco) => {
*     monaco.editor.create(div, this.dataset.config);
  * }); */
 var ERequire = import("monaco-editor/min/vs/loader.js");

   /* ERequire.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs' }}); */
  ERequire(['vs/editor/editor.main'], function() {
    monaco.editor.create(document.getElementById('code-container'), this.datase.config);
  });
</script>
